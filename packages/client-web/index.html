<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LAF - Live Stations</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }

      /* Light (default) and dark theme */
      :root {
        --bg: #f5f5f5;
        --surface: #fff;
        --border: #111;
        --text: #111;
        --text-muted: #444;
        --accent: #111;
        --accent-text: #fff;
        --grid-gap: 1rem;
        --topbar-bg: #111;
        --topbar-text: #fff;
        --footer-bg: #111;
        --footer-text: #fff;
        --card-hover: #eee;
        --status-live: #0a7c0a;
        --status-offline: #c00;
      }
      [data-theme="dark"] {
        --bg: #111;
        --surface: #1a1a1a;
        --border: #eee;
        --text: #eee;
        --text-muted: #aaa;
        --accent: #eee;
        --accent-text: #111;
        --topbar-bg: #000;
        --topbar-text: #eee;
        --footer-bg: #000;
        --footer-text: #eee;
        --card-hover: #252525;
        --status-live: #2ecc2e;
        --status-offline: #e74c3c;
      }

      body {
        font-family: Chicago, "Charcoal", "Lucida Grande", system-ui, -apple-system, sans-serif;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
        padding-bottom: 80px; /* space for fixed footer */
        -webkit-font-smoothing: none;
        font-smoothing: none;
      }

      /* Top bar */
      .site-topbar {
        position: sticky;
        top: 0;
        left: 0;
        right: 0;
        height: 48px;
        background: var(--topbar-bg);
        color: var(--topbar-text);
        border-bottom: 1px solid var(--border);
        display: grid;
        grid-template-columns: 1fr auto;
        align-items: center;
        padding: 0 16px;
        z-index: 20;
        font-size: 13px;
        font-weight: bold;
      }
      .topbar-left {
        display: flex;
        align-items: center;
        gap: 24px;
        min-width: 0;
      }
      .topbar-logo {
        color: var(--topbar-text);
        text-decoration: none;
        font-weight: bold;
        flex-shrink: 0;
      }
      .topbar-logo:hover { opacity: 0.9; }
      .topbar-nav {
        display: flex;
        align-items: center;
        gap: 4px;
      }
      .topbar-nav-item {
        color: var(--topbar-text);
        text-decoration: none;
        padding: 8px 12px;
        border: 1px solid transparent;
      }
      .topbar-nav-item:hover { background: rgba(255,255,255,0.1); }
      .topbar-nav-item.active { background: rgba(255,255,255,0.2); }
      .topbar-center { justify-self: center; display: flex; align-items: center; }
      .topbar-search { width: 200px; max-width: 100%; padding: 6px 10px; font-size: 13px; margin: 0; border: 1px solid rgba(255,255,255,0.3); border-radius: 4px; }
      /* Macintosh 1984 style: clock and search */
      .topbar-clock {
        font-variant-numeric: tabular-nums;
        font-size: 12px;
        padding: 4px 8px;
        margin: 0 4px;
        border: 1px solid rgba(255,255,255,0.4);
        background: rgba(0,0,0,0.2);
        box-shadow: inset 1px 1px 0 rgba(255,255,255,0.15);
        border-radius: 0;
        min-width: 4.5em;
        text-align: center;
      }
      .topbar-search-wrap {
        display: flex;
        align-items: center;
        gap: 0;
        min-width: 0;
      }
      .topbar-search-toggle {
        width: 28px;
        height: 28px;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 1px solid rgba(255,255,255,0.5);
        background: rgba(0,0,0,0.25);
        color: var(--topbar-text);
        font-size: 14px;
        cursor: pointer;
        border-radius: 0;
        box-shadow: inset 1px 1px 0 rgba(255,255,255,0.1);
        flex-shrink: 0;
      }
      .topbar-search-toggle:hover { background: rgba(255,255,255,0.15); }
      .topbar-search-toggle .search-icon-retro { display: block; }
      .topbar-search-field {
        display: none;
        align-items: center;
        margin-left: 4px;
        border: 1px solid rgba(255,255,255,0.5);
        background: rgba(0,0,0,0.2);
        box-shadow: inset 1px 1px 0 rgba(0,0,0,0.2);
        border-radius: 0;
        overflow: hidden;
      }
      .topbar-search-wrap.expanded .topbar-search-toggle { margin-right: 0; }
      .topbar-search-wrap.expanded .topbar-search-field { display: flex; }
      .topbar-search-wrap.expanded .topbar-search-field .topbar-search {
        width: 180px;
        border: none;
        background: transparent;
        box-shadow: none;
        border-radius: 0;
      }
      .topbar-search-field .topbar-search-close {
        width: 22px;
        height: 100%;
        padding: 0;
        border: none;
        border-left: 1px solid rgba(255,255,255,0.3);
        background: transparent;
        color: var(--topbar-text);
        font-size: 14px;
        cursor: pointer;
        line-height: 1;
        flex-shrink: 0;
      }
      .topbar-search-field .topbar-search-close:hover { background: rgba(255,255,255,0.15); }
      .live-view-toolbar { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; margin-bottom: 16px; }
      .live-view-toolbar .page-header { margin-bottom: 0; }
      .view-mode-switcher { display: flex; gap: 4px; flex-wrap: wrap; }
      .view-mode-btn { padding: 6px 12px; font-size: 12px; border-radius: 0; }
      .view-mode-btn.active { background: var(--accent); color: var(--accent-text); border-color: var(--accent); }
      .stations-list-view { display: flex; flex-direction: column; gap: 6px; }
      .stations-list-view.hidden { display: none !important; }
      .station-list-bar { display: flex; align-items: center; justify-content: space-between; gap: 12px; padding: 12px 16px; background: var(--surface); border: 1px solid var(--border); cursor: pointer; text-align: left; font-family: inherit; color: var(--text); width: 100%; }
      .station-list-bar:hover { background: var(--card-hover); }
      .station-list-bar.now-playing { border-width: 2px; font-weight: bold; }
      .station-list-bar .list-bar-name { font-weight: bold; flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
      .station-list-bar .list-bar-location { font-size: 12px; color: var(--text-muted); flex-shrink: 0; }
      .station-list-bar .list-bar-status { font-size: 11px; flex-shrink: 0; }
      .favorites-filter-wrap { display: flex; align-items: center; gap: 8px; font-size: 13px; cursor: pointer; }
      .favorites-filter-wrap input { width: auto; margin: 0; }
      .stations-grid-unified { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: var(--grid-gap); }
      .stations-grid-unified.hidden { display: none !important; }
      .station-card-fav { position: absolute; top: 8px; right: 8px; z-index: 2; background: transparent; border: none; padding: 4px; cursor: pointer; font-size: 18px; line-height: 1; opacity: 0.8; }
      .station-card-fav:hover { opacity: 1; }
      .station-card-fav.favorited { opacity: 1; }
      .topbar-right {
        display: flex;
        align-items: center;
        gap: 8px;
        justify-self: end;
        min-width: 0;
        flex-shrink: 0;
      }
      .theme-toggle {
        background: transparent;
        border: 1px solid rgba(255,255,255,0.5);
        color: var(--topbar-text);
        padding: 6px 10px;
        font-size: 12px;
        cursor: pointer;
        font-weight: bold;
        font-family: inherit;
        border-radius: 4px;
      }
      .theme-toggle:hover { background: rgba(255,255,255,0.15); }

      /* Hamburger: visible only on mobile */
      .menu-toggle {
        display: none;
        background: transparent;
        border: 1px solid rgba(255,255,255,0.5);
        color: var(--topbar-text);
        width: 40px;
        height: 40px;
        padding: 0;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 18px;
        font-family: inherit;
        border-radius: 4px;
        flex-shrink: 0;
        -webkit-tap-highlight-color: transparent;
      }
      .menu-toggle:hover { background: rgba(255,255,255,0.1); }
      .menu-toggle:focus { outline: 2px solid var(--topbar-text); outline-offset: 2px; }
      .nav-backdrop {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        z-index: 18;
        opacity: 0;
        transition: opacity 0.2s;
      }
      .nav-drawer {
        position: fixed;
        top: 0;
        right: 0;
        width: 280px;
        max-width: 85vw;
        height: 100vh;
        background: var(--topbar-bg);
        color: var(--topbar-text);
        border-left: 1px solid var(--border);
        z-index: 25;
        padding: 24px 16px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        transform: translateX(100%);
        transition: transform 0.25s ease;
        overflow-y: auto;
      }
      .nav-drawer .topbar-nav-item { display: block; padding: 12px 14px; min-height: 44px; box-sizing: border-box; }
      .nav-drawer .theme-toggle { width: 100%; justify-content: center; min-height: 44px; border-radius: 4px; }
      body.nav-open .nav-backdrop { display: block; opacity: 1; }
      body.nav-open .nav-drawer { transform: translateX(0); }

      /* Main content: brutalist grid */
      .main {
        max-width: 1200px;
        margin: 0 auto;
        padding: 24px 16px;
      }
      .view { display: none; }
      .view.active { display: block; }

      .page-header {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 24px;
        padding-bottom: 12px;
        border-bottom: 1px solid var(--border);
      }
      .page-content {
        font-size: 14px;
        line-height: 1.6;
        margin-bottom: 24px;
      }
      .page-content p { margin-bottom: 12px; }
      .page-content a { color: var(--text); text-decoration: underline; }
      .page-content a:hover { opacity: 0.8; }
      .page-content h2 { font-size: 16px; margin: 24px 0 12px; }

      /* Grid sections */
      .section-title {
        font-size: 14px;
        font-weight: bold;
        margin: 32px 0 16px;
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }
      .section-title:first-of-type { margin-top: 0; }

      .channels-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: var(--grid-gap);
        margin-bottom: 24px;
      }
      .channel-card {
        background: var(--surface);
        border: 1px solid var(--border);
        padding: 0;
        cursor: pointer;
        transition: background 0.15s;
      }
      .channel-card:hover { background: var(--card-hover); }
      .channel-card.now-playing { border-width: 2px; }
      .channel-card .card-title {
        padding: 10px 12px;
        font-size: 13px;
        font-weight: bold;
        border-bottom: 1px solid var(--border);
      }
      .channel-card .card-body { padding: 12px 14px; }
      .channel-card-cover {
        display: block;
        width: 100%;
        max-height: 100px;
        object-fit: cover;
        margin-bottom: 8px;
        border: 1px solid var(--border);
      }
      .channel-desc { font-size: 12px; color: var(--text-muted); line-height: 1.4; }
      .live-badge {
        display: inline-block;
        background: var(--accent);
        color: var(--accent-text);
        padding: 2px 8px;
        font-size: 11px;
        font-weight: bold;
        margin-top: 6px;
      }

      .stations-search {
        width: 100%;
        max-width: 320px;
        padding: 10px 12px;
        margin-bottom: 16px;
        border: 1px solid var(--border);
        background: var(--surface);
        color: var(--text);
        font-size: 14px;
        font-family: inherit;
      }
      .stations-search::placeholder { color: var(--text-muted); }
      .stations-loading-message { text-align: center; padding: 48px 24px; font-size: 16px; color: var(--text-muted); }
      .stations-loading-message .stations-loading-text { animation: loading-pulse 1.2s ease-in-out infinite; }
      .stations-loading-count { display: block; margin-top: 8px; font-size: 14px; opacity: 0.9; }
      @keyframes loading-pulse { 0%, 100% { opacity: 0.7; } 50% { opacity: 1; } }
      .external-stations-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: var(--grid-gap);
      }
      .external-station-card {
        background: var(--surface);
        border: 1px solid var(--border);
        padding: 12px 14px;
        cursor: pointer;
        transition: background 0.15s;
      }
      .external-station-card:hover { background: var(--card-hover); }
      .external-station-card.now-playing { border-width: 2px; }
      .external-station-card .ext-station-logo-wrap {
        position: relative;
        width: 48px;
        height: 48px;
        margin-bottom: 8px;
      }
      .external-station-card .ext-station-logo {
        display: block;
        width: 48px;
        height: 48px;
        object-fit: contain;
      }
      .external-station-card .ext-station-initial {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        font-weight: bold;
        color: var(--text);
        background: var(--card-hover);
      }
      .external-station-card .ext-station-initial.hidden { display: none; }
      .external-station-card .ext-station-name-only {
        font-size: 16px;
        font-weight: bold;
        margin-bottom: 8px;
        line-height: 1.3;
      }
      .external-station-card .ext-name { font-size: 13px; font-weight: bold; margin-bottom: 6px; }
      .external-station-card .ext-location { font-size: 11px; color: var(--text-muted); margin-bottom: 4px; }
      .external-station-card .ext-desc { font-size: 12px; color: var(--text-muted); line-height: 1.4; }
      .external-station-card .ext-link { font-size: 11px; margin-top: 8px; color: var(--text-muted); text-decoration: underline; }
      .external-station-card .ext-link:hover { color: var(--text); }
      .external-station-card .ext-stream-status { font-size: 11px; margin-top: 6px; font-weight: bold; }
      .external-station-card .ext-stream-status.status-checking,
      .external-station-card .ext-stream-status.status-unknown { color: var(--text-muted); }
      .external-station-card .ext-stream-status.status-live { color: var(--status-live); }
      .external-station-card .ext-stream-status.status-offline,
      .external-station-card .ext-stream-status.status-error,
      .external-station-card .ext-stream-status.status-timeout { color: var(--status-offline); }
      .external-station-card.stream-offline { opacity: 0.85; }
      .external-station-card-multi .ext-channels-toggle {
        margin-top: 8px;
        padding: 6px 10px;
        width: 100%;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        font-size: 12px;
        font-family: inherit;
        text-align: left;
        background: var(--bg);
        border: 1px solid var(--border);
        color: var(--text);
        cursor: pointer;
        box-sizing: border-box;
      }
      .external-station-card-multi .ext-channels-toggle:hover { background: var(--card-hover); }
      .external-station-card-multi .ext-channels-toggle .ext-channels-chevron { transition: transform 0.2s; }
      .external-station-card-multi.ext-channels-open .ext-channels-toggle .ext-channels-chevron { transform: rotate(180deg); }
      .external-station-card-multi .ext-channels-list { margin-top: 0; border-top: 1px solid var(--border); padding-top: 8px; display: none; flex-direction: column; gap: 4px; }
      .external-station-card-multi.ext-channels-open .ext-channels-list { display: flex; }
      .ext-channel-row {
        display: flex; align-items: center; justify-content: space-between; gap: 8px;
        padding: 6px 10px; text-align: left; font-size: 12px; font-family: inherit;
        background: var(--bg); border: 1px solid var(--border); color: var(--text);
        cursor: pointer; width: 100%; box-sizing: border-box;
      }
      .ext-channel-row:hover { background: var(--card-hover); }
      .ext-channel-row.now-playing { border-width: 2px; font-weight: bold; }
      .ext-channel-row .ext-channel-name { flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
      .ext-channel-row .ext-stream-status { margin: 0; font-size: 10px; flex-shrink: 0; }

      /* Fixed footer player */
      .footer-player {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: 72px;
        background: var(--footer-bg);
        color: var(--footer-text);
        border-top: 1px solid var(--border);
        display: grid;
        grid-template-columns: 44px 72px 1fr auto auto;
        align-items: center;
        gap: 12px;
        padding: 0 12px;
        padding-bottom: env(safe-area-inset-bottom, 0);
        z-index: 15;
      }
      .player-expand-btn {
        width: 44px;
        height: 44px;
        min-width: 44px;
        min-height: 44px;
        padding: 0;
        background: transparent;
        border: 1px solid rgba(255,255,255,0.4);
        color: var(--footer-text);
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        -webkit-tap-highlight-color: transparent;
      }
      .player-expand-btn:hover { background: rgba(255,255,255,0.1); }
      .player-expand-btn[aria-expanded="true"] { transform: rotate(180deg); }
      /* Expanded player panel */
      .player-expanded {
        position: fixed;
        bottom: 72px;
        left: 0;
        right: 0;
        max-height: calc(85vh - 72px);
        overflow-y: auto;
        overflow-x: hidden;
        -webkit-overflow-scrolling: touch;
        background: var(--footer-bg);
        color: var(--footer-text);
        border-top: 1px solid var(--border);
        padding: 20px 16px;
        padding-bottom: calc(20px + env(safe-area-inset-bottom, 0));
        z-index: 14;
        display: none;
      }
      .player-expanded.open { display: block; }
      .player-expanded-inner {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 16px;
        max-width: 360px;
        margin: 0 auto;
        min-width: 0;
      }
      .player-expanded-cover-wrap { width: 140px; height: 140px; background: var(--surface); border: 1px solid var(--border); overflow: hidden; flex-shrink: 0; border-radius: 4px; }
      .player-expanded-cover-wrap img { width: 100%; height: 100%; object-fit: contain; }
      .player-expanded-info { text-align: center; min-width: 0; width: 100%; }
      .player-expanded-title { font-size: 18px; font-weight: bold; margin-bottom: 6px; word-wrap: break-word; overflow-wrap: break-word; }
      .player-expanded-location { font-size: 12px; color: var(--text-muted); margin-bottom: 6px; }
      .player-expanded-desc { font-size: 13px; line-height: 1.45; margin-bottom: 12px; max-height: 4.5em; overflow-y: auto; }
      .player-expanded-link { font-size: 13px; color: var(--footer-text); text-decoration: underline; display: inline-block; padding: 4px 0; }
      .player-expanded-controls { display: flex; gap: 16px; align-items: center; justify-content: center; flex-shrink: 0; }
      .player-expanded-controls button {
        min-width: 48px;
        min-height: 48px;
        padding: 12px 20px;
        background: transparent;
        color: var(--footer-text);
        border: 1px solid var(--footer-text);
        font-size: 14px;
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;
      }
      .player-expanded-controls button:hover { background: rgba(255,255,255,0.15); }
      .footer-player .cover-wrap {
        position: relative;
        width: 56px;
        height: 56px;
        background: var(--surface);
        border: 1px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }
      .footer-player .cover-wrap.placeholder { background: var(--card-hover); }
      .footer-player .cover-wrap img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .footer-player .cover-wrap.placeholder img { display: none; }
      .footer-player .cover-wrap.external-logo img { object-fit: contain; }
      .footer-player .cover-wrap.placeholder::after {
        content: "\u266B";
        font-size: 24px;
        opacity: 0.6;
      }
      .footer-player .cover-initial {
        position: absolute;
        inset: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        font-weight: bold;
      }
      .footer-player .cover-initial.hidden { display: none; }
      .footer-player .info { min-width: 0; }
      .footer-player .info .title { font-size: 14px; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      .footer-player .info .desc { font-size: 11px; color: var(--text-muted); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
      .footer-player .controls {
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .footer-player .controls button {
        min-width: 44px;
        min-height: 44px;
        background: transparent;
        color: var(--footer-text);
        border: 1px solid var(--footer-text);
        padding: 8px 14px;
        font-size: 12px;
        font-weight: bold;
        font-family: inherit;
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;
      }
      .footer-player .controls button:hover { background: rgba(255,255,255,0.15); }
      .footer-player .controls button:disabled { opacity: 0.5; cursor: not-allowed; }
      .footer-player .status-text { font-size: 11px; color: var(--text-muted); max-width: 120px; text-align: right; }

      /* Expandable player details (optional, below footer or in a slide-out) */
      .player-detail {
        padding: 16px;
        background: var(--surface);
        border-top: 1px solid var(--border);
        display: none;
      }
      .player-detail.open { display: block; }
      .player-detail .stat-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 8px;
        margin-top: 12px;
      }
      .player-detail .stat-item {
        background: var(--bg);
        border: 1px solid var(--border);
        padding: 8px 10px;
      }
      .player-detail .stat-label { font-size: 10px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 4px; }
      .player-detail .stat-value { font-size: 13px; font-weight: bold; font-variant-numeric: tabular-nums; }
      .player-detail .chat-panel { margin-top: 16px; border-top: 1px solid var(--border); padding-top: 12px; }
      .player-detail .chat-title { font-size: 12px; font-weight: bold; margin-bottom: 8px; }
      .player-detail .chat-messages {
        height: 100px;
        overflow-y: auto;
        background: var(--bg);
        border: 1px solid var(--border);
        padding: 8px;
        font-size: 12px;
        margin-bottom: 8px;
      }
      .player-detail .chat-message { margin-bottom: 4px; word-break: break-word; }
      .player-detail .chat-message .chat-author { font-weight: bold; margin-right: 6px; }
      .player-detail .chat-signin-prompt { font-size: 11px; color: var(--text-muted); margin-bottom: 8px; }
      .player-detail .chat-input-row { display: flex; gap: 8px; }
      .player-detail .chat-input { flex: 1; padding: 6px 10px; border: 1px solid var(--border); font-size: 12px; background: var(--surface); color: var(--text); }
      .player-detail .chat-send { padding: 6px 12px; font-size: 12px; cursor: pointer; border: 1px solid var(--border); font-weight: bold; background: var(--surface); color: var(--text); }

      /* Buttons */
      button {
        background: var(--surface);
        color: var(--text);
        border: 1px solid var(--border);
        padding: 8px 16px;
        font-size: 12px;
        font-weight: bold;
        font-family: inherit;
        cursor: pointer;
      }
      button:hover { background: var(--card-hover); }
      button:disabled { opacity: 0.6; cursor: not-allowed; }

      .confirm-overlay {
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }
      .confirm-overlay.visible { display: flex; }
      .confirm-dialog {
        background: var(--surface);
        border: 1px solid var(--border);
        padding: 20px 24px;
        max-width: 360px;
      }
      .confirm-dialog .confirm-title { font-size: 14px; font-weight: bold; margin-bottom: 10px; }
      .confirm-dialog .confirm-message { font-size: 12px; margin-bottom: 16px; line-height: 1.4; }
      .confirm-dialog .confirm-buttons { display: flex; gap: 10px; justify-content: flex-end; }
      .form-group { margin-bottom: 10px; }
      .form-group label { display: block; margin-bottom: 4px; font-weight: bold; font-size: 12px; }
      .form-group input,
      .form-group textarea {
        width: 100%;
        padding: 8px 10px;
        border: 1px solid var(--border);
        background: var(--surface);
        color: var(--text);
        font-family: inherit;
      }
      .form-group textarea { resize: vertical; min-height: 60px; }
      .status { font-size: 13px; padding: 8px 10px; border: 1px solid var(--border); }
      .status.status-info { background: var(--card-hover); color: var(--text); }
      .status.status-error { background: rgba(200,0,0,0.1); color: var(--status-offline); border-color: var(--status-offline); }
      .auth-error { color: var(--status-offline); font-size: 12px; margin-top: 8px; }
      .auth-tab { padding: 6px 12px; border: 1px solid var(--border); background: var(--card-hover); cursor: pointer; font-weight: bold; }
      .auth-tab.active { background: var(--surface); }
      .admin-stations-list { display: flex; flex-direction: column; gap: 8px; }
      .admin-station-row { display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 12px; padding: 10px 12px; background: var(--surface); border: 1px solid var(--border); font-size: 13px; }
      .admin-station-row .admin-station-edit-form { grid-column: 1 / -1; }
      .admin-station-row .name { font-weight: bold; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
      .admin-station-row .stream-url { font-size: 11px; color: var(--text-muted); min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
      .admin-station-row button { flex-shrink: 0; }

      .hidden { display: none !important; }

      /* Mobile: refined layout, no overlap */
      @media (max-width: 768px) {
        body.nav-open { overflow: hidden; }
        .site-topbar {
          grid-template-columns: 1fr auto;
          padding: 0 10px;
          gap: 6px;
          min-height: 44px;
          height: auto;
        }
        .topbar-left {
          gap: 8px;
          align-items: center;
        }
        .menu-toggle { display: flex; }
        .topbar-nav { display: none !important; }
        .topbar-right {
          flex-wrap: nowrap;
          gap: 6px;
        }
        .topbar-right .topbar-nav-item,
        .topbar-right .theme-toggle,
        .topbar-right #client-logout-btn {
          padding: 6px 8px;
          font-size: 11px;
          white-space: nowrap;
        }
        .topbar-search {
          width: 100px;
          min-width: 80px;
          padding: 5px 8px;
          font-size: 12px;
        }
        #topbar-search-wrap { min-width: 0; }
        .topbar-search-wrap.expanded .topbar-search-field .topbar-search { width: 120px; min-width: 80px; }
        .topbar-clock { font-size: 11px; padding: 3px 6px; min-width: 3.8em; }
        .main { padding: 16px 12px; }
        .page-header { font-size: 20px; margin-bottom: 20px; padding-bottom: 10px; border-bottom-width: 1px; }
        .section-title { font-size: 12px; margin: 20px 0 10px; }
        .channels-grid { grid-template-columns: 1fr; gap: 12px; }
        .channel-card { border-width: 1px; }
        .channel-card.now-playing { border-width: 2px; }
        .external-stations-grid { grid-template-columns: 1fr; gap: 12px; }
        .stations-grid-unified { grid-template-columns: 1fr; gap: 12px; }
        .external-station-card { border-width: 1px; }
        .external-station-card.now-playing { border-width: 2px; }
        .stations-search { max-width: 100%; margin-bottom: 12px; border-width: 1px; }
        .footer-player {
          grid-template-columns: 44px 56px 1fr auto;
          gap: 8px;
          padding: 0 10px;
          height: 64px;
          min-height: 64px;
          border-top-width: 1px;
        }
        .footer-player .cover-wrap { width: 48px; height: 48px; min-width: 48px; min-height: 48px; }
        .footer-player .info { min-width: 0; }
        .footer-player .info .title { font-size: 13px; line-height: 1.2; }
        .footer-player .info .desc { font-size: 11px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .footer-player .controls button { min-width: 44px; min-height: 44px; padding: 8px 12px; font-size: 12px; }
        .footer-player .status-text { display: none; }
        body { padding-bottom: calc(64px + env(safe-area-inset-bottom, 0)); }
        .player-expanded { bottom: 64px; max-height: calc(100dvh - 64px - env(safe-area-inset-bottom, 0)); padding: 16px 12px; }
        .player-expanded-cover-wrap { width: 120px; height: 120px; }
        .player-expanded-title { font-size: 17px; }
        .player-expanded-controls button { min-width: 48px; min-height: 48px; padding: 12px 18px; }
        .confirm-dialog { max-width: calc(100vw - 24px); margin: 0 12px; }
        .ext-channel-row { border-width: 1px; }
        .ext-channel-row.now-playing { border-width: 2px; }
      }
      @media (max-width: 480px) {
        .site-topbar { height: 44px; padding: 0 8px; }
        .topbar-right .topbar-nav-item,
        .topbar-right .theme-toggle,
        .topbar-right #client-logout-btn { padding: 5px 6px; font-size: 10px; }
        .topbar-search { width: 72px; min-width: 60px; padding: 4px 6px; font-size: 11px; }
        .footer-player { height: 60px; min-height: 60px; grid-template-columns: 40px 44px 1fr auto; gap: 6px; padding: 0 8px; }
        .footer-player .cover-wrap { width: 44px; height: 44px; min-width: 44px; min-height: 44px; }
        .footer-player .info .title { font-size: 12px; }
        .footer-player .controls { gap: 4px; }
        .footer-player .controls button { min-width: 40px; min-height: 40px; padding: 6px 10px; font-size: 11px; }
        .player-expand-btn { width: 40px; height: 40px; min-width: 40px; min-height: 40px; font-size: 18px; }
        body { padding-bottom: calc(60px + env(safe-area-inset-bottom, 0)); }
        .player-expanded { bottom: 60px; max-height: calc(100dvh - 60px - env(safe-area-inset-bottom, 0)); }
      }
    </style>
  </head>
  <body>
    <div class="nav-backdrop" id="nav-backdrop" aria-hidden="true"></div>
    <nav class="site-topbar" id="site-topbar">
      <div class="topbar-left">
        <a href="#live" class="topbar-logo" id="nav-logo">LAF</a>
        <button type="button" class="menu-toggle" id="menu-toggle" aria-label="Open menu" aria-expanded="false">&#9776;</button>
        <div class="topbar-nav">
          <a href="#about" class="topbar-nav-item" id="nav-about">About</a>
          <a href="/broadcaster/" class="topbar-nav-item" id="nav-broadcast">Broadcast</a>
          <a href="#admin" class="topbar-nav-item hidden" id="nav-admin">Admin</a>
        </div>
      </div>
      <div class="topbar-right" id="client-topbar-right">
        <button type="button" class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">Dark</button>
        <a href="#" id="client-signin-link" class="topbar-nav-item">Sign in</a>
        <span id="client-user-email" class="topbar-nav-item hidden"></span>
        <button type="button" id="client-logout-btn" class="hidden" style="background:transparent;border:1px solid currentColor;color:inherit;padding:6px 12px;font-size:12px;">Logout</button>
        <div id="topbar-search-wrap" class="topbar-search-wrap">
          <button type="button" class="topbar-search-toggle" id="topbar-search-toggle" aria-label="Search stations" title="Search"><svg class="search-icon-retro" viewBox="0 0 16 16" width="16" height="16" aria-hidden="true"><circle cx="6.5" cy="6.5" r="4" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="square"/><path d="M9.5 9.5 L14 14" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="square"/></svg></button>
          <div class="topbar-search-field">
            <input type="text" id="stations-search-topbar" class="stations-search topbar-search" placeholder="Search stations..." aria-label="Search stations" />
            <button type="button" class="topbar-search-close" id="topbar-search-close" aria-label="Close search">&#215;</button>
          </div>
        </div>
        <span id="topbar-clock" class="topbar-clock" aria-live="polite"></span>
      </div>
    </nav>
    <div class="nav-drawer" id="nav-drawer" role="dialog" aria-label="Menu">
      <a href="#live" class="topbar-nav-item" data-nav="live">LAF</a>
      <a href="#about" class="topbar-nav-item" data-nav="about">About</a>
      <a href="/broadcaster/" class="topbar-nav-item" id="drawer-broadcast">Broadcast</a>
      <a href="#admin" class="topbar-nav-item hidden" id="drawer-admin">Admin</a>
      <button type="button" class="theme-toggle" id="theme-toggle-drawer">Dark</button>
      <a href="#" id="client-signin-link-drawer" class="topbar-nav-item">Sign in</a>
      <span id="client-user-email-drawer" class="topbar-nav-item hidden"></span>
      <button type="button" id="client-logout-btn-drawer" class="hidden" style="background:transparent;border:1px solid currentColor;color:inherit;padding:10px 14px;width:100%;text-align:left;font-weight:bold;cursor:pointer;">Logout</button>
    </div>

    <main class="main">
      <div id="view-live" class="view" role="main">
        <div class="live-view-toolbar">
          <h1 class="page-header">LIVE</h1>
          <div class="view-mode-switcher" role="tablist" aria-label="View mode">
            <button type="button" class="view-mode-btn active" data-mode="grid" aria-pressed="true">Card grid</button>
            <button type="button" class="view-mode-btn" data-mode="list" aria-pressed="false">List</button>
          </div>
          <label class="favorites-filter-wrap" id="favorites-filter-wrap">
            <input type="checkbox" id="favorites-filter" aria-label="Show favorites only" />
            <span>Favorites only</span>
          </label>
        </div>
        <div id="stations-view-container">
          <div id="stations-grid" class="stations-grid-unified" role="tabpanel"></div>
          <div id="stations-list" class="stations-list-view hidden" role="tabpanel"></div>
        </div>
      </div>

      <div id="view-about" class="view" role="main">
        <h1 class="page-header">About LAF</h1>
        <div class="page-content">
          <p>LAF is a live audio streaming platform. Broadcast your audio in real time or tune in to live stations from around the world.</p>
          <h2>Broadcast</h2>
          <p>Create an account, set up a channel, and go live. Stream audio from your microphone to anyone listening.</p>
          <h2>Live Stations</h2>
          <p>Browse stations that are currently live. Click to listen, sign in to participate in live chat.</p>
          <h2>Technology</h2>
          <p>LAF uses low-latency WebSocket streaming for real-time audio delivery.</p>
        </div>
      </div>

      <div id="view-admin" class="view" role="main">
        <h1 class="page-header">Add radio station</h1>
        <p style="margin-bottom: 16px; color: var(--text-muted);">Paste a radio website URL (e.g. https://www.subtleradio.com/) or a direct stream URL. Weâ€™ll find the live stream and add it to the feed.</p>
        <div class="page-content" style="max-width: 520px;">
          <div class="form-group">
            <label for="admin-url">Website or stream URL</label>
            <input type="url" id="admin-url" placeholder="https://www.example.com or https://example.com/stream.mp3" />
          </div>
          <div id="admin-status" class="status info hidden" style="margin-bottom: 12px;"></div>
          <button type="button" id="admin-submit-btn">Add station</button>
        </div>
        <div class="page-content" style="max-width: 720px; margin-top: 32px;">
          <h2 class="section-title">All stations on the site</h2>
          <p style="margin-bottom: 12px; color: var(--text-muted); font-size: 13px;">All stations. Edit any station to change name, description, logo or website. Delete any station to remove it from the site.</p>
          <div id="admin-stations-list" class="admin-stations-list"></div>
        </div>
      </div>
    </main>

    <footer class="footer-player" id="footer-player">
      <button type="button" class="player-expand-btn" id="player-expand-btn" aria-label="Expand player" aria-expanded="false" title="Expand">&#8964;</button>
      <div class="cover-wrap placeholder" id="player-cover-wrap">
        <img id="player-cover" class="player-cover" alt="" />
        <span id="player-cover-initial" class="cover-initial hidden" aria-hidden="true"></span>
      </div>
      <div class="info">
        <div class="title" id="now-playing-title">Not playing</div>
        <span id="player-live-badge" class="hidden" style="font-size:10px;margin-left:6px;">LIVE</span>
        <div class="desc" id="now-playing-desc"></div>
      </div>
      <div class="controls">
        <button type="button" id="btn-prev-station" class="external-only hidden" title="Previous">&#9664;</button>
        <button type="button" id="btn-play-pause" style="min-width:90px;"><span id="play-pause-icon">&#9654;</span> <span id="play-pause-text">Start</span></button>
        <button type="button" id="btn-next-station" class="external-only hidden" title="Next">&#9654;</button>
      </div>
      <div class="status-text" id="player-status-text">Ready to listen</div>
    </footer>
    <div class="player-expanded" id="player-expanded" aria-hidden="true">
      <div class="player-expanded-inner">
        <div class="player-expanded-cover-wrap" id="player-expanded-cover-wrap">
          <img id="player-expanded-cover" alt="" />
        </div>
        <div class="player-expanded-info">
          <h2 class="player-expanded-title" id="player-expanded-title">Not playing</h2>
          <div class="player-expanded-location" id="player-expanded-location"></div>
          <div class="player-expanded-desc" id="player-expanded-desc"></div>
          <a id="player-expanded-website-link" href="#" target="_blank" rel="noopener" class="player-expanded-link">Visit website</a>
        </div>
        <div class="player-expanded-controls">
          <button type="button" id="btn-prev-expanded" class="external-only hidden" title="Previous">&#9664;</button>
          <button type="button" id="btn-play-pause-expanded" style="min-width:100px;"><span id="play-pause-icon-expanded">&#9654;</span> <span id="play-pause-text-expanded">Start</span></button>
          <button type="button" id="btn-next-expanded" class="external-only hidden" title="Next">&#9654;</button>
        </div>
      </div>
    </div>

    <div class="player-detail" id="player-detail">
      <div class="stat-grid" id="player-stat-grid">
        <div class="stat-item"><div class="stat-label">Tier</div><div id="stat-tier" class="stat-value">-</div></div>
        <div class="stat-item"><div class="stat-label">Loss (2s)</div><div id="stat-loss" class="stat-value">-</div></div>
        <div class="stat-item"><div class="stat-label">Buffer</div><div id="stat-buffer" class="stat-value">-</div></div>
        <div class="stat-item"><div class="stat-label">Late Rate</div><div id="stat-late" class="stat-value">-</div></div>
        <div class="stat-item"><div class="stat-label">Est Latency</div><div id="stat-latency" class="stat-value">-</div></div>
        <div class="stat-item"><div class="stat-label">Bitrate</div><div id="stat-kbps" class="stat-value">-</div></div>
      </div>
      <div id="external-stream-actions" class="hidden" style="margin-top:8px;"><a id="external-visit-website" href="#" target="_blank" rel="noopener">Visit website</a></div>
      <p id="now-playing-program-wrap" class="hidden" style="font-size:11px;margin-top:8px;"><span id="now-playing-program"></span></p>
      <div class="chat-panel" id="player-chat-panel">
        <div class="chat-title">Live chat</div>
        <div id="chat-messages" class="chat-messages"></div>
        <div id="chat-signin-prompt" class="chat-signin-prompt">Sign in to participate in chat</div>
        <div id="chat-input-row" class="chat-input-row hidden">
          <input type="text" id="chat-input" class="chat-input" placeholder="Type a message..." maxlength="2000" />
          <button type="button" id="chat-send" class="chat-send">Send</button>
        </div>
      </div>
    </div>

    <div id="auth-overlay" class="confirm-overlay" aria-hidden="true">
      <div class="confirm-dialog">
        <div class="confirm-title">Sign in to chat</div>
        <div id="auth-tabs" style="display:flex;gap:8px;margin-bottom:12px;">
          <button type="button" id="auth-tab-login" class="auth-tab active">Login</button>
          <button type="button" id="auth-tab-register" class="auth-tab">Register</button>
        </div>
        <div id="auth-login-form">
          <div class="form-group"><label>Email</label><input type="email" id="auth-login-email" placeholder="your@email.com" /></div>
          <div class="form-group"><label>Password</label><input type="password" id="auth-login-password" placeholder="password" /></div>
          <button type="button" id="auth-login-btn">Login</button>
        </div>
        <div id="auth-register-form" class="hidden">
          <div class="form-group"><label>Email</label><input type="email" id="auth-register-email" placeholder="your@email.com" /></div>
          <div class="form-group"><label>Password</label><input type="password" id="auth-register-password" placeholder="8+ chars" /></div>
          <button type="button" id="auth-register-btn">Register</button>
        </div>
        <div id="auth-error" class="auth-error hidden"></div>
        <button type="button" id="auth-close" style="margin-top:12px;">Close</button>
      </div>
    </div>
    <div id="confirm-overlay" class="confirm-overlay" aria-hidden="true">
      <div class="confirm-dialog">
        <div class="confirm-title" id="confirm-title">Confirm</div>
        <div class="confirm-message" id="confirm-message"></div>
        <div class="confirm-buttons">
          <button type="button" id="confirm-cancel-btn">Cancel</button>
          <button type="button" id="confirm-ok-btn">OK</button>
        </div>
      </div>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>
